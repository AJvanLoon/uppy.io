"use strict";(self.webpackChunkuppy_io=self.webpackChunkuppy_io||[]).push([[2137],{8656:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>d,default:()=>c,frontMatter:()=>l,metadata:()=>p,toc:()=>h});var a=n(7462),o=(n(7294),n(3905)),i=n(5488),r=n(5162),s=n(3068);const l={sidebar_position:2},d="Tus",p={unversionedId:"uploader/tus",id:"uploader/tus",title:"Tus",description:"The @uppy/tus plugin brings resumable file uploading with Tus",source:"@site/docs/uploader/tus.mdx",sourceDirName:"uploader",slug:"/uploader/tus",permalink:"/uppy.io/pr-preview/pr-67/docs/uploader/tus",draft:!1,editUrl:"https://github.com/transloadit/uppy.io/tree/main/docs/uploader/tus.mdx",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Transloadit",permalink:"/uppy.io/pr-preview/pr-67/docs/uploader/transloadit"},next:{title:"AWS S3",permalink:"/uppy.io/pr-preview/pr-67/docs/uploader/aws-s3"}},u={},h=[{value:"When should I use it?",id:"when-should-i-use-it",level:2},{value:"Install",id:"install",level:2},{value:"Use",id:"use",level:2},{value:"API",id:"api",level:2},{value:"Options",id:"options",level:3},{value:"<code>id</code>",id:"id",level:4},{value:"<code>endpoint</code>",id:"endpoint",level:4},{value:"<code>headers</code>",id:"headers",level:4},{value:"<code>chunkSize</code>",id:"chunksize",level:4},{value:"<code>withCredentials</code>",id:"withcredentials",level:4},{value:"<code>retryDelays</code>",id:"retrydelays",level:4},{value:"<code>onBeforeRequest(req, file)</code>",id:"onbeforerequestreq-file",level:4},{value:"<code>onShouldRetry: (err, retryAttempt, options, next)</code>",id:"onshouldretry-err-retryattempt-options-next",level:4},{value:"<code>allowedMetaFields</code>",id:"allowedmetafields",level:4},{value:"<code>limit</code>",id:"limit",level:4},{value:"Frequently Asked Questions",id:"frequently-asked-questions",level:2},{value:"How is file meta data stored?",id:"how-is-file-meta-data-stored",level:3},{value:"How do I change files before sending them?",id:"how-do-i-change-files-before-sending-them",level:3},{value:"How do I change (or move) files after sending them?",id:"how-do-i-change-or-move-files-after-sending-them",level:3},{value:"Which server do you recommend?",id:"which-server-do-you-recommend",level:3},{value:"Are there hosted Tus servers?",id:"are-there-hosted-tus-servers",level:3},{value:"Why Tus instead of directly uploading to AWS S3?",id:"why-tus-instead-of-directly-uploading-to-aws-s3",level:3}],m={toc:h};function c(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"tus"},"Tus"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"@uppy/tus")," plugin brings resumable file uploading with ",(0,o.kt)("a",{parentName:"p",href:"http://tus.io"},"Tus"),"\nto Uppy by wrapping the ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-js-client"},(0,o.kt)("inlineCode",{parentName:"a"},"tus-js-client")),"."),(0,o.kt)("h2",{id:"when-should-i-use-it"},"When should I use it?"),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"Not sure which uploader is best for you? Read\n\u201c",(0,o.kt)("a",{parentName:"p",href:"/docs/guides/choosing-uploader"},"Choosing the uploader you need"),"\u201d.")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://tus.io/"},"Tus")," is an open protocol for resumable uploads built on HTTP. This means\naccidentally closing your tab or losing connection let\u2019s you continue, for\ninstance, your 10GB upload instead of starting all over."),(0,o.kt)("p",null,"Tus supports any language, any platform, and any network. It requires a client\nand server integration to work. You can checkout the client and server\n",(0,o.kt)("a",{parentName:"p",href:"https://tus.io/implementations.html"},"implementations")," to find the server in your preferred language. You can store\nfiles on the Tus server itself, but you can also use service integrations (such\nas S3) to store files externally. If you don\u2019t want to host your own server, see\n\u201c",(0,o.kt)("a",{parentName:"p",href:"#are-there-hosted-tus-servers"},"Are there hosted Tus servers?"),"\u201d."),(0,o.kt)("p",null,"If you want reliable, resumable uploads: use ",(0,o.kt)("inlineCode",{parentName:"p"},"@uppy/tus")," to connect to your Tus\nserver in a few lines of code."),(0,o.kt)("h2",{id:"install"},"Install"),(0,o.kt)(i.Z,{mdxType:"Tabs"},(0,o.kt)(r.Z,{value:"npm",label:"NPM",default:!0,mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"npm install @uppy/tus\n"))),(0,o.kt)(r.Z,{value:"yarn",label:"Yarn",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"yarn add @uppy/tus\n"))),(0,o.kt)(r.Z,{value:"cdn",label:"CDN",mdxType:"TabItem"},(0,o.kt)(s.Z,{mdxType:"UppyCdnExample"},"\n        import { Uppy, Tus } from \"{{UPPY_JS_URL}}\"\n        new Uppy().use(Tus, { endpoint: 'https://tusd.tusdemo.net/files' })\n      "))),(0,o.kt)("h2",{id:"use"},"Use"),(0,o.kt)("p",null,"A quick overview of the complete API."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:"{10} showLineNumbers","{10}":!0,showLineNumbers:!0},"import Uppy from '@uppy/core';\nimport Dashboard from '@uppy/dashboard';\nimport Tus from '@uppy/tus';\n\nimport '@uppy/core/dist/style.min.css';\nimport '@uppy/dashboard/dist/style.min.css';\n\nnew Uppy()\n    .use(Dashboard, { inline: true, target: 'body' })\n    .use(Tus, { endpoint: 'https://tusd.tusdemo.net/files/' });\n")),(0,o.kt)("h2",{id:"api"},"API"),(0,o.kt)("h3",{id:"options"},"Options"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"All options are passed to ",(0,o.kt)("inlineCode",{parentName:"p"},"tus-js-client")," and we document the ones here that are\nrequired, added, or changed. This means you can also pass functions like\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-js-client/blob/master/docs/api.md#onafterresponse"},(0,o.kt)("inlineCode",{parentName:"a"},"onAfterResponse")),"."),(0,o.kt)("p",{parentName:"admonition"},"We recommended taking a look at the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-js-client/blob/master/docs/api.md"},"API reference"),"\nfrom ",(0,o.kt)("inlineCode",{parentName:"p"},"tus-js-client")," to know what is supported.")),(0,o.kt)("h4",{id:"id"},(0,o.kt)("inlineCode",{parentName:"h4"},"id")),(0,o.kt)("p",null,"A unique identifier for this plugin (",(0,o.kt)("inlineCode",{parentName:"p"},"string"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"'Tus'"),")."),(0,o.kt)("h4",{id:"endpoint"},(0,o.kt)("inlineCode",{parentName:"h4"},"endpoint")),(0,o.kt)("p",null,"URL of the tus server (",(0,o.kt)("inlineCode",{parentName:"p"},"string"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"null"),")."),(0,o.kt)("h4",{id:"headers"},(0,o.kt)("inlineCode",{parentName:"h4"},"headers")),(0,o.kt)("p",null,"An object or function returning an object with HTTP headers to send to send\nalong requests (",(0,o.kt)("inlineCode",{parentName:"p"},"object | function"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"null"),")."),(0,o.kt)("p",null,"Keys are header names, values are header values."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const headers = {\n    authorization: `Bearer ${window.getCurrentUserToken()}`,\n};\n")),(0,o.kt)("p",null,"Header values can also be derived from file data by providing a function. The\nfunction receives an ",(0,o.kt)("a",{parentName:"p",href:"/docs/uppy-core#working-with-uppy-files"},"Uppy file")," and must return an object where the keys are\nheader names, and values are header values."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"const headers = (file) => {\n    return {\n        authorization: `Bearer ${window.getCurrentUserToken()}`,\n        expires: file.meta.expires,\n    };\n};\n")),(0,o.kt)("h4",{id:"chunksize"},(0,o.kt)("inlineCode",{parentName:"h4"},"chunkSize")),(0,o.kt)("p",null,"A number indicating the maximum size of a ",(0,o.kt)("inlineCode",{parentName:"p"},"PATCH")," request body in bytes\n(",(0,o.kt)("inlineCode",{parentName:"p"},"number"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"Infinity"),")."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Do not set this value unless you are forced to. The two valid reasons are\ndescribed in the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-js-client/blob/master/docs/api.md#chunksize"},(0,o.kt)("inlineCode",{parentName:"a"},"tus-js-client")," docs"),".")),(0,o.kt)("h4",{id:"withcredentials"},(0,o.kt)("inlineCode",{parentName:"h4"},"withCredentials")),(0,o.kt)("p",null,"Configure the requests to send Cookies using the\n",(0,o.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/withCredentials"},(0,o.kt)("inlineCode",{parentName:"a"},"xhr.withCredentials")),"\nproperty (",(0,o.kt)("inlineCode",{parentName:"p"},"boolean"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"false"),")."),(0,o.kt)("p",null,"The remote server must accept CORS and credentials."),(0,o.kt)("h4",{id:"retrydelays"},(0,o.kt)("inlineCode",{parentName:"h4"},"retryDelays")),(0,o.kt)("p",null,"When uploading a chunk fails, automatically try again after the defined\nmillisecond intervals (",(0,o.kt)("inlineCode",{parentName:"p"},"Array<number>"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"[0, 1000, 3000, 5000]"),")."),(0,o.kt)("p",null,"By default, we first retry instantly; if that fails, we retry after 1 second; if\nthat fails, we retry after 3 seconds, etc."),(0,o.kt)("p",null,"Set to ",(0,o.kt)("inlineCode",{parentName:"p"},"null")," to disable automatic retries, and fail instantly if any chunk\nfails to upload."),(0,o.kt)("h4",{id:"onbeforerequestreq-file"},(0,o.kt)("inlineCode",{parentName:"h4"},"onBeforeRequest(req, file)")),(0,o.kt)("p",null,"Behaves like the\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-js-client/blob/master/docs/api.md#onbeforerequest"},(0,o.kt)("inlineCode",{parentName:"a"},"onBeforeRequest")),"\nfunction from ",(0,o.kt)("inlineCode",{parentName:"p"},"tus-js-client")," but with the added ",(0,o.kt)("inlineCode",{parentName:"p"},"file")," argument."),(0,o.kt)("h4",{id:"onshouldretry-err-retryattempt-options-next"},(0,o.kt)("inlineCode",{parentName:"h4"},"onShouldRetry: (err, retryAttempt, options, next)")),(0,o.kt)("p",null,"When an upload fails ",(0,o.kt)("inlineCode",{parentName:"p"},"onShouldRetry")," is called with the error and the default\nretry logic as the last argument (",(0,o.kt)("inlineCode",{parentName:"p"},"function"),")."),(0,o.kt)("p",null,"The default retry logic is an\n",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Exponential_backoff"},"exponential backoff"),"\nalgorithm triggered on HTTP 429 (Too Many Requests) errors. Meaning if your\nserver (or proxy) returns HTTP 429 because it\u2019s being overloaded, @uppy/tus will\nfind the ideal sweet spot to keep uploading without overloading."),(0,o.kt)("p",null,"If you want to extend this functionality, for instance to retry on unauthorized\nrequests (to retrieve a new authentication token):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},"import Uppy from '@uppy/core';\nimport Tus from '@uppy/tus';\nnew Uppy().use(Tus, {\n    endpoint: '',\n    async onBeforeRequest(req) {\n        const token = await getAuthToken();\n        req.setHeader('Authorization', `Bearer ${token}`);\n    },\n    onShouldRetry(err, retryAttempt, options, next) {\n        if (err?.originalResponse?.getStatus() === 401) {\n            return true;\n        }\n        return next(err);\n    },\n    async onAfterResponse(req, res) {\n        if (res.getStatus() === 401) {\n            await refreshAuthToken();\n        }\n    },\n});\n")),(0,o.kt)("h4",{id:"allowedmetafields"},(0,o.kt)("inlineCode",{parentName:"h4"},"allowedMetaFields")),(0,o.kt)("p",null,"Pass an array of field names to limit the metadata fields that will be added to\nuploads as\n",(0,o.kt)("a",{parentName:"p",href:"https://tus.io/protocols/resumable-upload.html#upload-metadata"},"Tus Metadata"),"\n(",(0,o.kt)("inlineCode",{parentName:"p"},"Array"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"null"),")."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Set this to ",(0,o.kt)("inlineCode",{parentName:"li"},"['name']")," to only send the ",(0,o.kt)("inlineCode",{parentName:"li"},"name")," field."),(0,o.kt)("li",{parentName:"ul"},"Set this to ",(0,o.kt)("inlineCode",{parentName:"li"},"null")," (the default) to send ",(0,o.kt)("em",{parentName:"li"},"all")," metadata fields."),(0,o.kt)("li",{parentName:"ul"},"Set this to an empty array ",(0,o.kt)("inlineCode",{parentName:"li"},"[]")," to not send any fields.")),(0,o.kt)("h4",{id:"limit"},(0,o.kt)("inlineCode",{parentName:"h4"},"limit")),(0,o.kt)("p",null,"Limit the amount of uploads going on at the same time (",(0,o.kt)("inlineCode",{parentName:"p"},"number"),", default: ",(0,o.kt)("inlineCode",{parentName:"p"},"5"),")."),(0,o.kt)("p",null,"Setting this to ",(0,o.kt)("inlineCode",{parentName:"p"},"0")," means no limit on concurrent uploads (not recommend)"),(0,o.kt)("h2",{id:"frequently-asked-questions"},"Frequently Asked Questions"),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"The Tus website has extensive ",(0,o.kt)("a",{parentName:"p",href:"https://tus.io/faq.html"},"FAQ section"),", we\nrecommend taking a look there as well if something is unclear.")),(0,o.kt)("h3",{id:"how-is-file-meta-data-stored"},"How is file meta data stored?"),(0,o.kt)("p",null,"Tus uses unique identifers for the file names to prevent naming collisions. To\nstill keep the meta data in place, Tus also uploads an extra ",(0,o.kt)("inlineCode",{parentName:"p"},".info")," file with\nthe original file name and other meta data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "ID": "00007a99d16d4eeb5a3e3c080b6f69da+JHZavdqPSK4VMtarg2yYcNiP8t_kDjN51lBYMJdEyr_wqEotVl8ZBRBSTnWKWenZBwHvbLNz5tQXYp2N7Vdol.04ysQAuw__suTJ4IsCljj0rjyWA6LvV4IwF5P2oom2",\n    "Size": 1679852,\n    "SizeIsDeferred": false,\n    "Offset": 0,\n    "MetaData": {\n        "filename": "cat.jpg",\n        "filetype": "image/jpeg"\n    },\n    "IsPartial": false,\n    "IsFinal": false,\n    "PartialUploads": null,\n    "Storage": {\n        "Bucket": "your-bucket",\n        "Key": "some-key",\n        "Type": "s3store"\n    }\n}\n')),(0,o.kt)("h3",{id:"how-do-i-change-files-before-sending-them"},"How do I change files before sending them?"),(0,o.kt)("p",null,"If you want to change the file names, you want to do that in\n",(0,o.kt)("a",{parentName:"p",href:"/docs/uppy-core#onbeforefileaddedfile-files"},(0,o.kt)("inlineCode",{parentName:"a"},"onBeforeFileAdded")),"."),(0,o.kt)("p",null,"If you want to send extra headers with the request, use ",(0,o.kt)("a",{parentName:"p",href:"#headers"},(0,o.kt)("inlineCode",{parentName:"a"},"headers"))," or\n",(0,o.kt)("a",{parentName:"p",href:"#onbeforerequestreq-file"},(0,o.kt)("inlineCode",{parentName:"a"},"onBeforeRequest")),"."),(0,o.kt)("h3",{id:"how-do-i-change-or-move-files-after-sending-them"},"How do I change (or move) files after sending them?"),(0,o.kt)("p",null,"If you want to preserve files names, extract meta data, or move files to a\ndifferent place you generally can with hooks or events. It depends on the Tus\nserver you use how it\u2019s done exactly. ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tusd"},(0,o.kt)("inlineCode",{parentName:"a"},"tusd")),", for instance, exposes\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tusd/blob/master/docs/hooks.md"},"hooks")," and\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-node-server"},(0,o.kt)("inlineCode",{parentName:"a"},"tus-node-server"))," has\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tus-node-server#events"},"events"),"."),(0,o.kt)("h3",{id:"which-server-do-you-recommend"},"Which server do you recommend?"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://transloadit.com"},"Transloadit")," runs ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tusd"},(0,o.kt)("inlineCode",{parentName:"a"},"tusd"))," in production, where it\nserves millions of requests globally. Therefor we recommend ",(0,o.kt)("inlineCode",{parentName:"p"},"tusd")," as\nbattle-tested from our side, but other companies have had success with other\n",(0,o.kt)("a",{parentName:"p",href:"https://tus.io/implementations.html"},"implementations")," so it depends on your needs."),(0,o.kt)("h3",{id:"are-there-hosted-tus-servers"},"Are there hosted Tus servers?"),(0,o.kt)("p",null,"All ",(0,o.kt)("a",{parentName:"p",href:"https://transloadit.com/pricing"},"Transloadit plans")," come with a hosted\n",(0,o.kt)("a",{parentName:"p",href:"https://github.com/tus/tusd"},(0,o.kt)("inlineCode",{parentName:"a"},"tusd"))," server. You don\u2019t have to do anything to leverage it, using\n",(0,o.kt)("a",{parentName:"p",href:"/docs/upload-strategies/transloadit"},(0,o.kt)("inlineCode",{parentName:"a"},"@uppy/transloadit"))," automatically uses\nTus under the hood."),(0,o.kt)("h3",{id:"why-tus-instead-of-directly-uploading-to-aws-s3"},"Why Tus instead of directly uploading to AWS S3?"),(0,o.kt)("p",null,"First: reliable, resumable uploads. This means accidentally closing your tab or\nlosing connection let\u2019s you continue, for instance, your 10GB upload instead of\nstarting all over."),(0,o.kt)("p",null,"Tus is also efficient with lots of files (such as 8K) and large files. Uploading\nto AWS S3 directly from the client also introduces quite a bit of overhead, as\nmore requests are needed for the flow to work."))}c.isMDXComponent=!0}}]);
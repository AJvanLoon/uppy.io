"use strict";(self.webpackChunkuppy_io=self.webpackChunkuppy_io||[]).push([[5503],{64913:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>r,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>d});var i=o(85893),s=o(11151);const a={title:"Uppy 1.5: Facebook and OneDrive (beta) support, upload cancellation",date:new Date("2019-10-11T00:00:00.000Z"),author:"renee",published:!0,slug:"2019/10/1.5"},t=void 0,l={permalink:"/blog/2019/10/1.5",editUrl:"https://github.com/transloadit/uppy.io/tree/main/blog/2019-10-1.5.md",source:"@site/blog/2019-10-1.5.md",title:"Uppy 1.5: Facebook and OneDrive (beta) support, upload cancellation",description:"In the past two months, we have halved our open issue count and worked on a much",date:"2019-10-11T00:00:00.000Z",formattedDate:"October 11, 2019",tags:[],readingTime:8.435,hasTruncateMarker:!0,authors:[{name:"renee"}],frontMatter:{title:"Uppy 1.5: Facebook and OneDrive (beta) support, upload cancellation",date:"2019-10-11T00:00:00.000Z",author:"renee",published:!0,slug:"2019/10/1.5"},unlisted:!1,prevItem:{title:"Uppy 1.6: setOptions(), Icelandic and Thai",permalink:"/blog/2019/11/1.6"},nextItem:{title:"Uppy 1.3: Accessibility and performance, new languages",permalink:"/blog/2019/08/1.3"}},r={authorsImageUrls:[void 0]},d=[{value:"Issue busting",id:"issue-busting",level:2},{value:"Duplicate files",id:"duplicate-files",level:2},{value:"Dashboard",id:"dashboard",level:2},{value:"Cancellation",id:"cancellation",level:2},{value:"Lerna lerna lerna",id:"lerna-lerna-lerna",level:2},{value:"Localization",id:"localization",level:2},{value:"Facebook and OneDrive",id:"facebook-and-onedrive",level:2},{value:"Revoke Companion\u2019s Provider access on logout",id:"revoke-companions-provider-access-on-logout",level:2},{value:"Misc",id:"misc",level:2}];function c(e){const n={a:"a",code:"code",h2:"h2",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",source:"source",ul:"ul",video:"video",...(0,s.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.p,{children:"In the past two months, we have halved our open issue count and worked on a much\nmore robust approach to upload cancellation. Members of the community also\ncontributed a bunch of new localizations: Czech, Danish, Greek, Indonesian, and\nSwedish!"}),"\n",(0,i.jsx)(n.p,{children:"We are also releasing beta versions of new remote providers for Facebook and\nOneDrive. Please try them out!"}),"\n",(0,i.jsx)(n.h2,{id:"issue-busting",children:"Issue busting"}),"\n",(0,i.jsx)(n.p,{children:"Our issue tracker was getting pretty full over the past year, topping out at\nabout 120 open issues. Some had been open for months without any reply! Issues\nwere being opened at such a rate that it was almost too much for our small team\nto handle. So, we sat down to go through everything together and started setting\nup a process to make sure our issue list doesn't get out of hand again in the\nfuture."}),"\n",(0,i.jsx)(n.p,{children:"When opening a new issue, we now ask you to mark it as a bug or a feature\nrequest. The issue will also get a \u201cTriage\u201d label, indicating that an Uppy team\nmember needs to sort it. If there are many \u201cTriage\u201d issues open at any point, we\nwill discuss them in our weekly team call. New issues will also be assigned to a\nspecific team member as soon as possible, so each of us has a much smaller and\nmore manageable list of issues to keep track of."}),"\n",(0,i.jsxs)(n.p,{children:["To keep the issue tracker focused on Uppy features and bugs, detailed support\nquestions should go to Transloadit's\n",(0,i.jsx)(n.a,{href:"https://community.transloadit.com/",children:"community forum"}),"."]}),"\n",(0,i.jsx)(n.h2,{id:"duplicate-files",children:"Duplicate files"}),"\n",(0,i.jsxs)(n.p,{children:["Up until now, if you added a file that had been already added to Uppy some time\nbefore \u2014 i.e., a file with the same ",(0,i.jsx)(n.code,{children:"name"}),"/",(0,i.jsx)(n.code,{children:"type"}),"/",(0,i.jsx)(n.code,{children:"modifiedDate"})," etc. \u2014 the old\nfile would be silently replaced with a new one. This changes with v1.5:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Uppy now throws a warning if a file with the same ",(0,i.jsx)(n.code,{children:"file.id"})," already exist.\nThe new file will not be added and the old file will not be replaced."]}),"\n",(0,i.jsxs)(n.li,{children:["We are adding the ",(0,i.jsx)(n.code,{children:"file.meta.relativePath"})," to ",(0,i.jsx)(n.code,{children:"file.id"}),". ",(0,i.jsx)(n.code,{children:"relativePath"}),"\nexists on files that have been dropped together with a folder. This means\nthat if you drop a folder with ",(0,i.jsx)(n.code,{children:"folder/a.jpg"})," and ",(0,i.jsx)(n.code,{children:"folder/subfolder/a.jpg"}),",\nboth ",(0,i.jsx)(n.code,{children:"a.jpg"}),"s will be added, since they come from different folders and this\nkind of duplication might be intended."]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["See PR ",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/pull/1767",children:"#1767"})," for details."]}),"\n",(0,i.jsx)(n.h2,{id:"dashboard",children:"Dashboard"}),"\n",(0,i.jsx)(n.p,{children:"Files in the Dashboard no longer have an icon indicating where they came from\n(local device, GDrive, etc.). We think it's nice for developers to see, but not\nthat useful for most end users. If you want to re-enable it, you can add the\nfollowing CSS to your app:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-css",children:".uppy-DashboardItem-sourceIcon {\n\tdisplay: inline-block;\n}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The difference is very small. The icons used to be next to the file size, as\nseen here in Uppy v1.3:\n",(0,i.jsx)(n.img,{alt:"Uppy Dashboard v1.3, with file source icon",src:o(27143).Z+"",width:"1432",height:"573"})]}),"\n",(0,i.jsxs)(n.p,{children:["Now, in v1.5, they\u2019re gone:\n",(0,i.jsx)(n.img,{alt:"Uppy Dashboard v1.5, without file source icon",src:o(9459).Z+"",width:"1470",height:"557"})]}),"\n",(0,i.jsx)(n.p,{children:"Additionally:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Editing a file now fires ",(0,i.jsx)(n.code,{children:"dashboard:file-edit-start"})," and\n",(0,i.jsx)(n.code,{children:"dashboard:file-edit-complete"})," events\n(",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/pull/1776",children:"#1776"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Excessive debug logging is reduced\n(",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/pull/1747",children:"#1747"}),")"]}),"\n",(0,i.jsx)(n.li,{children:"Fixes to the TypeScript typings were submitted by @mrbatista and\n@MatthiasKunnen"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"cancellation",children:"Cancellation"}),"\n",(0,i.jsx)(n.p,{children:"Our old approach to limiting the amount of simultaneous uploads had some\nproblems. Uploads were queued by chaining Promises, but they did not respect\ncancellation. So, if you cancelled an upload while some files were still waiting\nto start, those files would actually start uploading even though they had\nalready been removed. Obviously, that's pretty bad!"}),"\n",(0,i.jsxs)(n.p,{children:["PR ",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/pull/1736",children:"#1736"})," addresses this by\nripping out the old limiting code and replacing it with a new,\ncancellation-aware upload queue. We\u2019ve also added a browser test to make sure\nthat this thing stays resilient:"]}),"\n",(0,i.jsxs)(n.video,{alt:"Demo video showing an automated Chaos Monkey session with Uppy",muted:!0,autoPlay:!0,loop:!0,children:["\n  ",(0,i.jsx)(n.source,{src:"/img/blog/1.5/chaos-monkey.webm",type:"video/webm"}),"\n  ",(0,i.jsx)(n.source,{src:"/img/blog/1.5/chaos-monkey.mp4",type:"video/mp4"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"lerna-lerna-lerna",children:"Lerna lerna lerna"}),"\n",(0,i.jsxs)(n.p,{children:["In August, we bit the bullet and used Lerna\u2019s ",(0,i.jsx)(n.code,{children:"lerna link convert"})," feature. Now,\nall the packages in our monorepo depend on each other, using\n",(0,i.jsx)(n.code,{children:"file:../packagename/"})," paths instead of version numbers. The entire repository\nis one big dependency tree in npm's view. Npm can install the entire thing on\nits own, without ",(0,i.jsx)(n.code,{children:"lerna bootstrap"}),"\u2019s help! Since npm manages the entire tree,\nthe ",(0,i.jsx)(n.code,{children:"package-lock.json"})," file in the repository root contains everything we need.\nWe can now use the faster ",(0,i.jsx)(n.code,{children:"npm ci"})," install command on CI, saving more than sixty\nseconds on every run \ud83c\udf89"]}),"\n",(0,i.jsxs)(n.p,{children:["As part of this effort, we also added all our examples to the lerna-managed\ntree, so you no longer have to do ",(0,i.jsx)(n.code,{children:"npm install"})," in example folders to use them."]}),"\n",(0,i.jsx)(n.p,{children:"This change makes working on the repository much easier, since dependencies are\nhandled in the same way as in any other repository, simply by doing:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install\n"})}),"\n",(0,i.jsx)(n.h2,{id:"localization",children:"Localization"}),"\n",(0,i.jsx)(n.p,{children:"Thanks to multiple contributors, Uppy now knows Czech, Danish, Greek,\nIndonesian, and Swedish, on top of the nineteen languages that were already\nsupported! The Serbian locale is now available in both the Cyrillic and Latin\nscripts. Big thanks to @achmiral, @arggh, @czj, @jukakoski, @marcusforberg,\n@nndevstudio, @Pzoco, @Tashows, and @tvaliasek for their efforts \u2728"}),"\n",(0,i.jsxs)(n.p,{children:["New translations are rolling in every month, but there are plenty more languages\nout there that Uppy would love to learn. Please consider\n",(0,i.jsx)(n.a,{href:"/docs/locales/#Contributing-a-new-language",children:"contributing your language"})," as\nwell!"]}),"\n",(0,i.jsx)(n.h2,{id:"facebook-and-onedrive",children:"Facebook and OneDrive"}),"\n",(0,i.jsxs)(n.p,{children:["This release adds two experimental new remote providers: Facebook and OneDrive.\nFor now, they are not available through the ",(0,i.jsx)(n.code,{children:"uppy"})," package. To use them, install\n",(0,i.jsx)(n.code,{children:"@uppy/facebook"})," or ",(0,i.jsx)(n.code,{children:"@uppy/onedrive"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"npm install @uppy/facebook\nnpm install @uppy/onedrive\n"})}),"\n",(0,i.jsx)(n.p,{children:"Configure Companion to access the Facebook and OneDrive APIs, using environment\nvariables or the JS API:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'export COMPANION_FACEBOOK_KEY="***"\nexport COMPANION_FACEBOOK_SECRET="***"\nexport COMPANION_ONEDRIVE_KEY="***"\nexport COMPANION_ONEDRIVE_SECRET="***"\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"providerOptions: {\n  facebook: {\n    key: '',\n    secret: ''\n  },\n  // For OneDrive\u2019s key & secret pair, please use `microsoft` option key\n  microsoft: {\n    key: '',\n    secret: ''\n  }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"Then use them like the existing providers:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-js",children:"const Facebook = require('@uppy/facebook');\nconst OneDrive = require('@uppy/onedrive');\n\nuppy.use(Facebook, { companionUrl: YOUR_COMPANION_URL });\nuppy.use(OneDrive, { companionUrl: YOUR_COMPANION_URL });\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We\u2019re still waiting for our developer keys to be approved, so we don't have\nworking examples on the website yet! We\u2019ll let you know on\n",(0,i.jsx)(n.a,{href:"https://twitter.com/uppy_io",children:"Twitter"})," when they\u2019re live."]}),"\n",(0,i.jsx)(n.p,{children:"Once these new providers have been tested for a while, we will release them as\n1.0 and include them in the main Uppy and Robodog bundles."}),"\n",(0,i.jsx)(n.h2,{id:"revoke-companions-provider-access-on-logout",children:"Revoke Companion\u2019s Provider access on logout"}),"\n",(0,i.jsx)(n.p,{children:"Up until now, when users clicked \u201clogout\u201d after using a remote Provider, such as\nGoogle Drive or Dropbox, Uppy would destroy the access token. But on the\nProvider\u2019s side, Uppy was still allowed access. Should the user click \u201cConnect\nto Google Drive\u201d again, no extra confirmation was required."}),"\n",(0,i.jsxs)(n.p,{children:["After a discussion in ",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/issues/1563",children:"#1563"}),",\nwe are expanding the logout process. Now, when users log out of remote Providers\nthrough Uppy, Companion will destroy the token as before, but also attempt to\nrevoke the access from the corresponding Provider. In the event that the\nProvider doesn\u2019t support access revoke via it\u2019s API, Uppy will display a helpful\nmessage informing users how they can revoke the permissions manually."]}),"\n",(0,i.jsxs)(n.p,{children:["See ",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/pull/1843",children:"#1843"})," for details."]}),"\n",(0,i.jsx)(n.h2,{id:"misc",children:"Misc"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"@uppy/aws-s3-multipart: fix queueing behaviors, especially interaction with\ncancellation (@goto-bus-stop, #1855)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/aws-s3: replace browser-only resolve-url by isomorphic url-parse\n(@goto-bus-stop, #1854)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/companion-client: rename serverHeaders to companionHeaders\n(@goto-bus-stop, #1861)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/companion: Fix S3 uploads for URL plugins (#1784 / @@ifedapoolarewaju)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/companion: bump lodash.merge to 4.6.2 to fix audit warning (#1796 /\n@rettgerst)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/companion: set allowed HTTP methods internally (#1754 /\n@ifedapoolarewaju)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/companion: whenever an error is returned from Companion: the auth screen\nwill be displayed if the user was never authenticated; if the user is\nauthenticated, the last screen on display before the error will be displayed\n(#1743 / @ifedapoolarewaju)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/core: Made sure we can upload new files if we cancel last file\n(allowMultipleUploads: false) (#1764 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/core: fix \"Cannot read property 'log' of undefined\" (#1785 / @theJoeBiz)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/core: use setFileState inside retryUpload (#1759 / @goto-bus-stop)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/dashboard, @uppy/drag-drop: getDroppedFiles.js: handle exceptions better\n(#1797 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/form: try/catch parsing, set updatedResult to an empty array when not an\narray (#1800 / @arturi)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/locales: Finnish semantics improved and fixed some typos (#1744 /\n@jukakoski)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/locales: Update sr_RS_Latin.js (#1749 / @nndevstudio)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/locales: correct some fr_FR localization strings (#1807 / @czj)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/locales: fix typo in Persian locale (@uxitten, #1865)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/locales: improve Swedish translation (@marcusforberg, #1859)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/thumbnail-generator: add waitForThumbnailsBeforeUpload option, false by\ndefault (@arturi, #1803)"}),"\n",(0,i.jsx)(n.li,{children:"@uppy/transloadit: add limit option, warn about using limit when it\u2019s set\nto 0. In Uppy 2.0 we\u2019ll set the limit to something sensible (like 10 files) by\ndefault. (#1789 / @arturi)"}),"\n",(0,i.jsxs)(n.li,{children:["@uppy/transloadit: pin socket.io version to ES5 compatible one\n(@goto-bus-stop,\n",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/commit/5839b655f093edaa778d49b719f7dda063ef79cb",children:"https://github.com/transloadit/uppy/commit/5839b655f093edaa778d49b719f7dda063ef79cb"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["@uppy/xhr-upload: Throw an error when trying to upload a remote file with\n",(0,i.jsx)(n.code,{children:"bundle: true"})," (#1769 / @arturi)"]}),"\n",(0,i.jsx)(n.li,{children:"build: Fix statefulset update: statefulsets image only should be updated.\n(#1821 / @kiloreux)"}),"\n",(0,i.jsx)(n.li,{children:"build: Update eslint to v6 (#1777 / @goto-bus-stop)"}),"\n",(0,i.jsx)(n.li,{children:"build: ci: tweak job run order (#1740 / @goto-bus-stop)"}),"\n",(0,i.jsx)(n.li,{children:"core: Made addFile return the file id (#1739 / @eliOcs)"}),"\n",(0,i.jsx)(n.li,{children:"docs: Link to Transloadit plugin from Robodog Form page (#1810 / @janko)"}),"\n",(0,i.jsx)(n.li,{children:"docs: Talk about using a custom-file input, instead of the file-input plugin\n(#1765 / @arturi)"}),"\n",(0,i.jsx)(n.li,{children:"docs: add \u201cforce metafield\u201d to docs and changelog\n(ab053e7ab266d3a4838069ed23675bb9211e4d1a / @arturi)"}),"\n",(0,i.jsx)(n.li,{children:"docs: explicitly document supported tus-js-client options (#1755 /\n@goto-bus-stop)"}),"\n",(0,i.jsx)(n.li,{children:"docs: fix typo (@leftdevel, #1852)"}),"\n",(0,i.jsx)(n.li,{children:"docs: redux - mentioned that we can't persist Uppy state (#1793 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"docs: remove pre-1.0 notice from changelog (@mskelton, #1858)"}),"\n",(0,i.jsx)(n.li,{children:"docs: talk about marking some files as \u201calready uploaded\u201d\n(c345cbd58992f7bea9525629c28d38420c6b36a3 / @arturi)"}),"\n",(0,i.jsx)(n.li,{children:"test: add end-to-end test with retries (@ifedapoolarewaju, #1766)"}),"\n",(0,i.jsx)(n.li,{children:"tests: e2e: reintroduce e2e test for providers locally (#1706 /\n@ifedapoolarewaju)"}),"\n",(0,i.jsx)(n.li,{children:"website: /examples/dragdrop - added more obvious 'file was uploaded' indicator\n(#1750 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"website: /examples/xhrupload - more obvious UI, added a list of uploaded files\n(#1768 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"website: add new version of hexo-filter-github-emojis (#1783 / @lakesare)"}),"\n",(0,i.jsx)(n.li,{children:"website: fix docs/locales code escaping and css overflow\n(5a0055c15d04d97e8a0feb784daa7abe8da1d72d / @arturi)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["As always, you can find the full list of changes and package versions, as well\nas future plans, in our\n",(0,i.jsx)(n.a,{href:"https://github.com/transloadit/uppy/blob/master/CHANGELOG.md",children:"changelog"}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},27143:(e,n,o)=>{o.d(n,{Z:()=>i});const i=o.p+"assets/images/with-source-icon-1688bd96924f14cffa611f00163cb978.png"},9459:(e,n,o)=>{o.d(n,{Z:()=>i});const i=o.p+"assets/images/without-source-icon-8a537cd041e1aecd14dd6bc425d83a59.png"},11151:(e,n,o)=>{o.d(n,{Z:()=>l,a:()=>t});var i=o(67294);const s={},a=i.createContext(s);function t(e){const n=i.useContext(a);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:t(e.components),i.createElement(a.Provider,{value:n},e.children)}}}]);